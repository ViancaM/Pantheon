{% extends 'game/base.html' %}
{% load static %}

{% block title %}Pantheon - Home{% endblock %}

{% block extra_css %}
<style>
    body {
        background: #0a0a1a;
        color: #e2e8ff;
        min-height: 100vh;
        margin: 0;
        padding: 0;
        position: relative;
        overflow-x: hidden;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: 
            radial-gradient(circle at 20% 30%, rgba(80, 60, 180, 0.4) 0%, transparent 50%),
            radial-gradient(circle at 80% 70%, rgba(60, 80, 200, 0.3) 0%, transparent 50%),
            radial-gradient(circle at 40% 80%, rgba(120, 40, 200, 0.2) 0%, transparent 50%),
            url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100%25' height='100%25'%3E%3Cdefs%3E%3Cpattern id='stars' width='100' height='100' patternUnits='userSpaceOnUse'%3E%3Ccircle cx='50' cy='50' r='0.5' fill='%23ffffff' opacity='0.8'/%3E%3Ccircle cx='20' cy='20' r='0.3' fill='%23ffffff' opacity='0.6'/%3E%3Ccircle cx='80' cy='80' r='0.4' fill='%23ffffff' opacity='0.7'/%3E%3Ccircle cx='30' cy='70' r='0.2' fill='%23ffffff' opacity='0.5'/%3E%3Ccircle cx='70' cy='30' r='0.3' fill='%23ffffff' opacity='0.6'/%3E%3Ccircle cx='10' cy='40' r='0.4' fill='%23ffffff' opacity='0.7'/%3E%3Ccircle cx='90' cy='60' r='0.3' fill='%23ffffff' opacity='0.6'/%3E%3Ccircle cx='40' cy='10' r='0.2' fill='%23ffffff' opacity='0.5'/%3E%3Ccircle cx='60' cy='90' r='0.3' fill='%23ffffff' opacity='0.6'/%3E%3C/pattern%3E%3C/defs%3E%3Crect width='100%25' height='100%25' fill='url(%23stars)'/%3E%3C/svg%3E");
        z-index: -1;
    }
    
    .main-container {
        background: rgba(10, 10, 25, 0.9);
        border-radius: 15px;
        padding: 2rem;
        margin: 2rem;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(100, 100, 200, 0.3);
        width: 90%;
        max-width: 800px; /* Fixed maximum width */
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
    }
    
    .nav-tabs {
        border-bottom: 1px solid rgba(100, 100, 200, 0.3);
        margin-bottom: 2rem;
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
    }
    
    .nav-tabs .nav-link {
        color: #a8c0ff;
        border: 1px solid rgba(100, 100, 200, 0.3);
        margin-bottom: -1px;
        padding: 12px 20px;
        background: rgba(20, 20, 40, 0.8);
        transition: all 0.3s ease;
        flex: 1;
        min-width: 120px;
        text-align: center;
    }
    
    .nav-tabs .nav-link.active {
        background: linear-gradient(135deg, rgba(80, 80, 200, 0.3) 0%, rgba(100, 60, 160, 0.3) 100%);
        color: #fff;
        border-color: rgba(100, 100, 220, 0.5);
        border-bottom-color: transparent;
    }
    
    .nav-tabs .nav-link:hover {
        border-color: rgba(120, 120, 220, 0.4);
        background: rgba(80, 80, 200, 0.2);
        color: #c2d0ff;
    }
    
    .tab-content {
        padding: 2rem 0;
        min-height: 400px;
    }
    
    .tab-pane {
        width: 100%;
    }
    
    .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        padding: 12px 30px;
        font-size: 1.1rem;
        margin: 1rem 0;
        border-radius: 8px;
        transition: all 0.3s ease;
    }
    
    .btn-primary:hover {
        background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }
    
    .game-title {
        text-align: center;
        margin-bottom: 2rem;
        font-size: 3rem;
        background: linear-gradient(135deg, #a8c0ff 0%, #c2a8ff 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        font-weight: bold;
    }
    
    .settings-container {
        max-width: 500px;
        margin: 0 auto;
    }
    
    .form-range {
        width: 100%;
    }
    
    .form-check-input:checked {
        background-color: #667eea;
        border-color: #667eea;
    }
    
    .play-content {
        text-align: center;
        padding: 2rem;
    }
    
    .help-content, .about-content {
        max-width: 400px;
        margin: 0 auto;
    }
    
    .form-control, .form-range {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: #e2e8ff;
    }
    
    .form-label {
        color: #a8c0ff;
        font-weight: 500;
    }

    /* Save button feedback */
    .btn-saved {
        background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%) !important;
        transform: scale(0.95);
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
        .main-container {
            margin: 1rem;
            padding: 1.5rem;
            width: 95%;
        }
        
        .game-title {
            font-size: 2.5rem;
        }
        
        .nav-tabs .nav-link {
            padding: 10px 15px;
            font-size: 0.9rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="main-container">
    <h1 class="game-title">PANTHEON</h1>
    
    <ul class="nav nav-tabs justify-content-center" id="mainTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="play-tab" data-bs-toggle="tab" data-bs-target="#play" type="button" role="tab">
                Play Game
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="settings-tab" data-bs-toggle="tab" data-bs-target="#settings" type="button" role="tab">
                Settings
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="help-tab" data-bs-toggle="tab" data-bs-target="#help" type="button" role="tab">
                Help
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="about-tab" data-bs-toggle="tab" data-bs-target="#about" type="button" role="tab">
                About
            </button>
        </li>
    </ul>
    
    <div class="tab-content" id="mainTabsContent">
        <!-- Play Game Tab -->
        <div class="tab-pane fade show active" id="play" role="tabpanel">
            <div class="play-content">
                <h2 style="color: #e2e8ff;">Start Your Journey</h2>
                <p class="lead" style="color: #c2a8ff;">Embark on a celestial challenge of strategy and skill</p>
                <button class="btn btn-primary btn-lg" id="start-game-btn">
                    Start New Game
                </button>
                <div class="mt-4">
                    <h4 style="color: #e2e8ff;">Quick Rules</h4>
                    <p style="color: #c2a8ff;">Complete three cards of the same element to win!</p>
                    <small style="color: #a8c0ff;">Elements: Earth • Air • Fire • Water</small>
                </div>
            </div>
        </div>
        
        <!-- Settings Tab -->
        <div class="tab-pane fade" id="settings" role="tabpanel">
            <div class="settings-container">
                <h2 class="text-center mb-4" style="color: #e2e8ff;">Game Settings</h2>
                <div class="mb-4">
                    <label class="form-label">Music Volume: <span id="game-music-display">50%</span></label>
                    <input type="range" class="form-range" id="game-music-volume" min="0" max="100" value="50">
                </div>
                <div class="mb-4">
                    <label class="form-label">Sound Effects: <span id="game-sfx-display">70%</span></label>
                    <input type="range" class="form-range" id="game-sfx-volume" min="0" max="100" value="70">
                </div>
                <div class="form-check form-switch mb-4">
                    <input class="form-check-input home-fullscreen-toggle" type="checkbox">
                    <label class="form-check-label" style="color: #e2e8ff;">
                        Fullscreen Mode
                    </label>
                </div>
                <div class="text-center">
                    <button class="btn btn-primary" id="save-home-settings">Save Settings</button>
                </div>
            </div>
        </div>
        
        <!-- Help Tab -->
        <div class="tab-pane fade" id="help" role="tabpanel">
            <div class="help-content">
                <h2 class="text-center mb-4" style="color: #e2e8ff;">How to Play</h2>
                <div class="row">
                    <div class="col-md-6">
                        <h4 style="color: #e2e8ff;">Game Objective</h4>
                        <p style="color: #c2a8ff;">Be the first player to complete three cards that all share the same element.</p>
                        
                        <h4 style="color: #e2e8ff;">Elements</h4>
                        <ul style="color: #c2a8ff;">
                            <li>Earth</li>
                            <li>Air</li>
                            <li>Fire</li>
                            <li>Water</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h4 style="color: #e2e8ff;">Turn Actions</h4>
                        <ul style="color: #c2a8ff;">
                            <li><strong>Attempt Challenge:</strong> Try to complete an Active Card's challenge</li>
                            <li><strong>Forsake:</strong> Discard an Active Card and draw a new one</li>
                            <li><strong>Trade:</strong> Exchange cards with another player</li>
                            <li><strong>Skip:</strong> Pass your turn</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- About Tab -->
        <div class="tab-pane fade" id="about" role="tabpanel">
            <div class="about-content">
                <div class="text-center">
                    <h2 style="color: #e2e8ff;">About Pantheon</h2>
                    <p class="lead" style="color: #c2a8ff;">A competitive card-based challenge game with celestial themes</p>
                    
                    <div class="mt-4">
                        <p style="color: #c2a8ff;">Pantheon is a strategic card game where players complete challenges while managing disadvantages.</p>
                        
                        <h4 style="color: #e2e8ff;">Game Assets</h4>
                        <ul class="list-unstyled" style="color: #c2a8ff;">
                            <li>24 Zodiac Cards</li>
                            <li>4 Retrograde Cards</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://kit.fontawesome.com/a81368914c.js" crossorigin="anonymous"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const startGameBtn = document.getElementById('start-game-btn');
        const saveHomeSettingsBtn = document.getElementById('save-home-settings');
        
        // Load saved settings
        loadSettings();
        
        // Handle start game button
        startGameBtn.addEventListener('click', function() {
            const settings = JSON.parse(localStorage.getItem('pantheonSettings') || '{}');
            const wantsFullscreen = settings.fullscreen || false;
            
            if (wantsFullscreen && !document.fullscreenElement) {
                document.documentElement.requestFullscreen().then(() => {
                    setTimeout(() => {
                        window.location.href = "{% url 'game' %}";
                    }, 100);
                }).catch(() => {
                    window.location.href = "{% url 'game' %}";
                });
            } else {
                window.location.href = "{% url 'game' %}";
            }
        });
        
        // Home tab settings
        saveHomeSettingsBtn.addEventListener('click', function() {
            saveSettings();
            this.classList.add('btn-saved');
            this.textContent = '✓ Saved!';
            setTimeout(() => {
                this.classList.remove('btn-saved');
                this.textContent = 'Save Settings';
            }, 2000);
        });
        
        // Update volume displays
        document.querySelector('.home-music-volume').addEventListener('input', function() {
            document.getElementById('music-display').textContent = this.value + '%';
        });
        
        document.querySelector('.home-sfx-volume').addEventListener('input', function() {
            document.getElementById('sfx-display').textContent = this.value + '%';
        });
        
        // Handle fullscreen toggle
        document.querySelector('.home-fullscreen-toggle').addEventListener('change', function() {
            if (this.checked && !document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(() => {
                    this.checked = false;
                });
            } else if (!this.checked && document.fullscreenElement) {
                document.exitFullscreen();
            }
        });
        
        function saveSettings() {
            const settings = {
                musicVolume: document.querySelector('.home-music-volume').value,
                sfxVolume: document.querySelector('.home-sfx-volume').value,
                fullscreen: document.querySelector('.home-fullscreen-toggle').checked
            };
            localStorage.setItem('pantheonSettings', JSON.stringify(settings));
        }
        
        function loadSettings() {
            const savedSettings = localStorage.getItem('pantheonSettings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                document.querySelector('.home-music-volume').value = settings.musicVolume || 50;
                document.getElementById('music-display').textContent = (settings.musicVolume || 50) + '%';
                document.querySelector('.home-sfx-volume').value = settings.sfxVolume || 70;
                document.getElementById('sfx-display').textContent = (settings.sfxVolume || 70) + '%';
                document.querySelector('.home-fullscreen-toggle').checked = settings.fullscreen || false;
            }
        }
        
        // Update fullscreen toggle based on actual state
        document.addEventListener('fullscreenchange', function() {
            document.querySelector('.home-fullscreen-toggle').checked = !!document.fullscreenElement;
            const settings = JSON.parse(localStorage.getItem('pantheonSettings') || '{}');
            settings.fullscreen = !!document.fullscreenElement;
            localStorage.setItem('pantheonSettings', JSON.stringify(settings));
        });
        
        // Initialize
        loadSettings();
    });
</script>
{% endblock %}